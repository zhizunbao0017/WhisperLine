# æœ¬åœ°æ¨¡æ‹Ÿ EAS æ„å»ºæŒ‡å—

åœ¨æäº¤ EAS æ„å»ºä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿæ¥éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œé¿å…æµªè´¹æ„å»ºæ¬¡æ•°ã€‚

## å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: è½»é‡çº§æ¨¡æ‹Ÿï¼ˆæ¨èï¼Œå¿«é€Ÿï¼‰
```bash
npm run simulate:build:light
```

**ä¼˜ç‚¹**ï¼š
- âš¡ å¿«é€Ÿï¼ˆä¸åˆ é™¤ node_modulesï¼‰
- âœ… éªŒè¯æ‰€æœ‰å…³é”®é…ç½®
- ğŸ¯ é€‚åˆæ—¥å¸¸ä½¿ç”¨

**éªŒè¯å†…å®¹**ï¼š
- âœ… ç¯å¢ƒå˜é‡è®¾ç½®
- âœ… ä¾èµ–å®‰è£…éªŒè¯
- âœ… Babel é…ç½®æµ‹è¯•
- âœ… app.config.js åŠ è½½æµ‹è¯•
- âœ… Metro å…¥å£ç‚¹è§£æ
- âœ… å¸¸è§é—®é¢˜æ£€æŸ¥

### æ–¹æ³• 2: å®Œæ•´æ¨¡æ‹Ÿï¼ˆå½»åº•ï¼Œä½†è¾ƒæ…¢ï¼‰
```bash
npm run simulate:build
```

**ä¼˜ç‚¹**ï¼š
- ğŸ§¹ å®Œå…¨æ¸…ç†ç¯å¢ƒï¼ˆæ¨¡æ‹Ÿå…¨æ–° EAS æ„å»ºï¼‰
- ğŸ” æ›´å½»åº•çš„æµ‹è¯•
- ğŸ“¦ æµ‹è¯•ä¾èµ–å®‰è£…è¿‡ç¨‹

**æ³¨æ„**ï¼šä¼šåˆ é™¤ `node_modules`ï¼Œéœ€è¦é‡æ–°å®‰è£…ä¾èµ–ï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰

### æ–¹æ³• 3: å•ç‹¬æµ‹è¯•ï¼ˆæœ€å¿«ï¼‰
```bash
# åªæµ‹è¯• Babel é…ç½®
npm run test:babel

# åªéªŒè¯ä¾èµ–
npm run test:deps

# åŒæ—¶è¿è¡Œä¸¤ä¸ªæµ‹è¯•
npm run prebuild:check
```

## æµ‹è¯•è„šæœ¬è¯´æ˜

### `npm run test:babel`
å¿«é€Ÿæµ‹è¯• Babel é…ç½®æ˜¯å¦èƒ½æ­£ç¡®åŠ è½½ `babel-plugin-module-resolver`

### `npm run test:deps`
éªŒè¯æ‰€æœ‰å…³é”®çš„ Babel æ’ä»¶æ˜¯å¦å·²æ­£ç¡®å®‰è£…

### `npm run simulate:build:light`
è½»é‡çº§æ¨¡æ‹Ÿ EAS æ„å»ºç¯å¢ƒï¼Œä¸åˆ é™¤ node_modules

### `npm run simulate:build`
å®Œæ•´æ¨¡æ‹Ÿ EAS æ„å»ºç¯å¢ƒï¼ŒåŒ…æ‹¬æ¸…ç†å’Œé‡æ–°å®‰è£…ä¾èµ–

### `npm run prebuild:check`
è¿è¡Œä¾èµ–éªŒè¯å’Œ Babel æµ‹è¯•ï¼ˆå¿«é€Ÿæ£€æŸ¥ï¼‰

## æ¨¡æ‹Ÿæ„å»ºéªŒè¯çš„å†…å®¹

1. **ç¯å¢ƒå˜é‡**ï¼šè®¾ç½®ä¸ EAS production æ„å»ºç›¸åŒçš„ç¯å¢ƒå˜é‡
2. **ä¾èµ–éªŒè¯**ï¼šç¡®ä¿æ‰€æœ‰å¿…éœ€çš„ Babel æ’ä»¶éƒ½å·²å®‰è£…
3. **Babel é…ç½®**ï¼šæµ‹è¯• babel.config.js æ˜¯å¦èƒ½æ­£ç¡®åŠ è½½
4. **app.config.js**ï¼šéªŒè¯åº”ç”¨é…ç½®æ˜¯å¦æ­£ç¡®
5. **Metro å…¥å£ç‚¹**ï¼šæ£€æŸ¥ expo-router å…¥å£ç‚¹æ˜¯å¦èƒ½è§£æ
6. **å¸¸è§é—®é¢˜**ï¼šæ£€æŸ¥ package.jsonã€.npmrcã€eas.json é…ç½®

## æ¨¡æ‹Ÿæ„å»º vs çœŸå®æ„å»º

### âœ… æ¨¡æ‹Ÿæ„å»ºå¯ä»¥éªŒè¯ï¼š
- JavaScript/Babel é…ç½®
- ä¾èµ–å®‰è£…
- é…ç½®æ–‡ä»¶åŠ è½½
- Metro bundler å…¥å£ç‚¹

### âŒ æ¨¡æ‹Ÿæ„å»ºæ— æ³•éªŒè¯ï¼š
- åŸç”Ÿ iOS ä»£ç ç¼–è¯‘
- CocoaPods ä¾èµ–
- Xcode æ„å»ºè¿‡ç¨‹
- è¯ä¹¦å’Œç­¾å

## ä½¿ç”¨æµç¨‹

### æ¨èæµç¨‹ï¼š
```bash
# 1. å¿«é€Ÿæ£€æŸ¥ï¼ˆå‡ ç§’é’Ÿï¼‰
npm run prebuild:check

# 2. å¦‚æœé€šè¿‡ï¼Œè¿è¡Œè½»é‡çº§æ¨¡æ‹Ÿï¼ˆ1-2åˆ†é’Ÿï¼‰
npm run simulate:build:light

# 3. å¦‚æœå…¨éƒ¨é€šè¿‡ï¼Œæäº¤ä»£ç å¹¶æ„å»º
git add .
git commit -m "Fix babel-plugin-module-resolver build issue"
git push
eas build --platform ios --profile production
```

### å¦‚æœå‘ç°é—®é¢˜ï¼š
1. æ ¹æ®é”™è¯¯ä¿¡æ¯ä¿®å¤é—®é¢˜
2. é‡æ–°è¿è¡Œæµ‹è¯•
3. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡åå†æäº¤ EAS æ„å»º

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼š`babel-plugin-module-resolver not found`
**è§£å†³**ï¼š
```bash
npm install babel-plugin-module-resolver --save
```

### é—®é¢˜ï¼šä¾èµ–éªŒè¯å¤±è´¥
**è§£å†³**ï¼š
```bash
rm -rf node_modules package-lock.json
npm install
npm run test:deps
```

### é—®é¢˜ï¼šBabel é…ç½®åŠ è½½å¤±è´¥
**æ£€æŸ¥**ï¼š
- `babel.config.js` è¯­æ³•æ˜¯å¦æ­£ç¡®
- æ‰€æœ‰å¼•ç”¨çš„æ’ä»¶æ˜¯å¦å·²å®‰è£…
- æ’ä»¶æ˜¯å¦åœ¨ `dependencies` ä¸­ï¼ˆä¸æ˜¯ `devDependencies`ï¼‰

## æ³¨æ„äº‹é¡¹

1. **package-lock.json**ï¼šç¡®ä¿å·²æäº¤åˆ° gitï¼ŒEAS ä¼šä½¿ç”¨å®ƒæ¥å®‰è£…ä¾èµ–
2. **ä¾èµ–ä½ç½®**ï¼šæ‰€æœ‰ Babel æ’ä»¶å¿…é¡»åœ¨ `dependencies` ä¸­ï¼Œä¸èƒ½åªåœ¨ `devDependencies` ä¸­
3. **ç¼“å­˜**ï¼šå¦‚æœæ¨¡æ‹Ÿé€šè¿‡ä½† EAS æ„å»ºå¤±è´¥ï¼Œå¯èƒ½æ˜¯ç¼“å­˜é—®é¢˜ï¼Œç¡®ä¿ `eas.json` ä¸­ç¼“å­˜å·²ç¦ç”¨

## ç›¸å…³æ–‡ä»¶

- `scripts/test-babel-only.js` - Babel é…ç½®æµ‹è¯•è„šæœ¬
- `scripts/verify-dependencies.js` - ä¾èµ–éªŒè¯è„šæœ¬
- `scripts/simulate-eas-build-light.sh` - è½»é‡çº§æ¨¡æ‹Ÿè„šæœ¬
- `scripts/simulate-eas-build.sh` - å®Œæ•´æ¨¡æ‹Ÿè„šæœ¬

